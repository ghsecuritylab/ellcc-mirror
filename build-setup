# This file determins the target list and compilers to use.
# Get the supported targets.
targets=`cat $prefix/targets`
targetlist=`echo $targets | sed -e "s/ /,/g"`

bin=$prefix/bin
bindir=$bin
# Get the build processor. For now it is also the host and target processor.
build=`uname -m`
host=$build
target=$build 
os=linux
arg1=
hostos=`uname -s`

if [ $# -ge 1 ] ; then
  # The first argument is the desired cross host.
  host=$1
  arg1=$host
  bindir=$bindir-$host-$os
  hostos=Linux
  shift
fi

if [ "x$hostos" = "xLinux" ] ; then
  # ELLCC can currently build itself only for Linux.
  if [ `which ecc` ] ; then
    # ecc exists, and is in the PATH.
    ecc=ecc
  fi

  if [ -e $bin/ecc ]; then
    ecc=$bin/ecc
  fi
fi

if [ "x$ecc" != "x" ] ; then
  # An ecc exists, use it to compile.
  if [ -e $prefix/libecc/lib/$host/$os/libc.a ]; then
    # To build for host with libecc:
    cc=$ecc
    cxx=$ecc++
    hcc=$ecc
    hcxx=$ecc++
    if [ -e $ecc-ar ]; then
      ar=$ecc-ar
    else
      ar=ar
    fi
    builddir="-$host-$os"
    haslibs=yes
    WHY="build for $host with libecc using ecc"
  else
    # libecc has not been built, use the host's libraries.
    cc=$ecc
    cxx=$ecc++
    hcc=$ecc
    hcxx=$ecc++
    ar=ar
    builddir=""
    haslibs=no
    WHY="build for $host with host libraries using ecc"
  fi
else
  # Build with the gcc compiler
  cc=gcc
  cxx=g++
  hcc=gcc
  hcxx=g++
  ar=ar
  builddir=""
  haslibs=no
  WHY="build for $host with host libraries using gcc"
fi

